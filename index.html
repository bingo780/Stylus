// --- AUTO-DETEKCIA (PERO vs PRST) ---
const canvas = document.getElementById('stylusCanvas');
const ctx = canvas.getContext('2d');
let drawing = false;

// KĽÚČOVÉ NASTAVENIE: Canvas nebude blokovať prsty
canvas.style.touchAction = 'auto'; 

function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return {
        x: (e.clientX - rect.left) * scaleX,
        y: (e.clientY - rect.top) * scaleY,
        pressure: e.pressure || 0.5
    };
}

canvas.addEventListener('pointerdown', (e) => {
    // AK JE TO PERO (pen) - KRESLÍME
    if (e.pointerType === 'pen') {
        drawing = true;
        const pos = getPos(e);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
        // Zastavíme scroll LEN pre pero, aby sa papier pod hrotom nehýbal
        canvas.releasePointerCapture(e.pointerId); 
    }
    // AK JE TO PRST (touch) - NEROBÍME NIČ (prehliadač sám začne scrollovať)
});

canvas.addEventListener('pointermove', (e) => {
    if (!drawing || e.pointerType !== 'pen') return;

    const pos = getPos(e);
    ctx.lineWidth = (pos.pressure * 3) + 1;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#000080';
    
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
});

window.addEventListener('pointerup', (e) => {
    drawing = false;
});
